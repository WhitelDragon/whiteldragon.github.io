{%- comment -%}
Возвращает URL первой картинки для превью или пустую строку.
Порядок:
1) post.image / post.thumb во фронтматтере (если заданы)
2) первая <img src="..."> из отрендеренного post.content
{%- endcomment -%}

{%- assign thumb = "" -%}

{%- if include.post.image %}{% assign thumb = include.post.image %}{% endif -%}
{%- if thumb == "" and include.post.thumb %}{% assign thumb = include.post.thumb %}{% endif -%}

{%- if thumb == "" and include.post.content -%}
  {%- assign parts = include.post.content | split:'<img ' -%}
  {%- if parts.size > 1 -%}
    {%- assign first_img = parts[1] -%}
    {%- assign src_split = first_img | split:'src="' -%}
    {%- if src_split.size > 1 -%}
      {%- assign after_src = src_split[1] -%}
      {%- assign url = after_src | split:'"' | first -%}
      {%- if url != "" -%}
        {%- assign thumb = url -%}
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

{#-- Если нужно, можно нормализовать относительный путь: --#}
{%- if thumb != "" -%}
  {%- assign has_http = thumb | slice:0,4 -%}
  {%- assign first_char = thumb | slice:0,1 -%}
  {%- if has_http == "http" -%}
    {# уже абсолютный, оставляем как есть #}
  {%- elsif first_char == "/" -%}
    {# корневой путь — оставим как есть #}
  {%- else -%}
    {# относительный — превратим в относительный с учётом baseurl #}
    {%- assign thumb = "/" | append: thumb | relative_url -%}
  {%- endif -%}
{%- endif -%}

{{ thumb }}
